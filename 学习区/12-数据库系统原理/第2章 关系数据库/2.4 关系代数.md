---
命名: __2.4 关系代数
课程:
  - "[[第2章 关系数据库]]"
状态: 完成
创建时间: Invalid date
执行人: 蔡蔡鸿宇
时间安排: Invalid date
待解决问题: 待解决:[ 0 ]
created: 2025-03-29T21:52
updated: 2025-03-29T21:52
---
> [!important]

> [!important]

# 2.4 关系代数

关系代数是关系数据库的**核心查询语言**，通过集合运算和关系操作描述数据操作逻辑。所有运算的输入和输出均为关系，支持组合操作实现复杂查询。

---

## 2.4.1 传统集合运算

假设关系 $R$ 和 $S$ **属性结构相同**（并相容性），可进行以下运算：

---

### 1. 并（Union）

**定义**：合并 $R$ 和 $S$ 的元组，去除重复项

**数学表示**：

$R \cup S = \{ t \mid t \in R \ \lor \ t \in S \}$

**示例**：

- $R$ 表（学生A班）：
    
    |   |   |
    |---|---|
    |学号|姓名|
    |001|张三|
    |002|李四|
    
- $S$ 表（学生B班）：
    
    |   |   |
    |---|---|
    |学号|姓名|
    |002|李四|
    |003|王五|
    
- **结果**（合并班级）：
    
    |   |   |
    |---|---|
    |学号|姓名|
    |001|张三|
    |002|李四|
    |003|王五|
    

---

### 2. 差（Difference）

**定义**：返回在 $R$ 中但不在 $S$ 中的元组

**数学表示**：

$R - S = \{ t \mid t \in R \ \land \ t \notin S \}$

**示例**（筛选未退课学生）：

- $R$（全体选课学生）：{001, 002, 003}
- $S$（已退课学生）：{002}
- **结果**：{001, 003}

---

### 3. 交（Intersection）

**定义**：返回同时在 $R$ 和 $S$ 中的元组

**数学表示**：

$R \cap S = \{ t \mid t \in R \ \land \ t \in S \}$

**示例**（共同选修课程）：

- $R$（张三的课程）：{数学, 物理}
- $S$（李四的课程）：{物理, 化学}
- **结果**：{物理}

---

### 4. 笛卡尔积（Cartesian Product）

**定义**：将 $R$ 的每个元组与 $S$ 的所有元组组合

**数学表示**：

$R \times S = \{ (r_1, \dots, r_n, s_1, \dots, s_m) \mid r \in R \ \land \ s \in S \}$

**基数计算**：若 $R$ 有 $n$ 行，$S$ 有 $m$ 行，结果含 $n \times m$ 行

**示例**（学生与课程组合）：

- $R$（学生表）：
    
    |   |   |
    |---|---|
    |学号|姓名|
    |001|张三|
    
- $S$（课程表）：
    
    |   |   |
    |---|---|
    |课程号|课程名|
    |C01|数学|
    |C02|物理|
    
- **结果**：
    
    |   |   |   |   |
    |---|---|---|---|
    |学号|姓名|课程号|课程名|
    |001|张三|C01|数学|
    |001|张三|C02|物理|
    

---

### 关键特性与注意事项

1. **运算前提**：
    - 并、差、交要求 $R$ 和 $S$ **属性结构完全一致**（属性名、类型、顺序相同）
2. **笛卡尔积的实用性**：
    - 通常与**选择操作**结合使用（如 $σ_{R.A=S.A}(R \times S)$ 实现连接）
    - 实际应用中需谨慎使用，可能生成海量数据
3. **运算优先级**：
    - 笛卡尔积 > 选择/投影 > 并/差/交
    - 可通过括号明确优先级

---

### 应用场景示例

**查询同时选修“数据库”和“操作系统”的学生**：

1. 筛选课程号为 C01 和 C02 的选课记录：
    1. $\text{临时表}T1 = \pi_{\text{Sno}}(\sigma_{\text{Cno}='C01'}(SC))$
    2. $\text{临时表}T2 = \pi_{\text{Sno}}(\sigma_{\text{Cno}='C02'}(SC))$
2. 取交集：$\text{结果} = T1 \cap T2$
3. 连接学生表获取姓名：$\pi_{\text{Sname}}(\text{Student} \bowtie \text{结果})$

传统集合运算为复杂查询提供基础，后续结合**选择、投影、连接**可实现完整查询逻辑。

---

## 2.4.2 专门的关系运算

专门的关系运算是关系代数的核心，用于从关系模型中提取特定数据，包含以下四种关键操作：

---

### 1. 选择（Selection）

**定义**：从关系中筛选满足条件的元组（**水平操作**）。

**数学表示**：

$\sigma_{F}(R) = \{ t \mid t \in R \ \land \ F(t) \ \text{为真} \}$

- **F**：逻辑表达式（如 `A=5 ∧ B>'X'`）

**示例**（筛选计算机系学生）：

$\sigma_{\text{Sdept}='CS'}(\text{Student})$

**输入** Student 表：

|   |   |   |
|---|---|---|
|Sno|Sname|Sdept|
|201215121|李勇|CS|
|201215122|刘晨|CS|
|201215123|王敏|MA|
|**输出**：|||
|Sno|Sname|Sdept|
|---------|-------|-------|
|201215121|李勇|CS|
|201215122|刘晨|CS|

---

### 2. 投影（Projection）

**定义**：选取指定属性列（**垂直操作**），自动去重。

**数学表示**：$\pi_{A_1, A_2, \dots, A_k}(R)$

- $A_i$：目标属性列

**示例**（查询所有专业名称）：$\pi_{\text{Sdept}}(\text{Student})$

**输出**：

Sdept

---

CS

---

MA

---

---

### 3. 连接（Join）

**定义**：通过公共属性组合两个关系的元组。

### (1) 等值连接（Equi-Join）

**公式**：

$R \bowtie_{A=B} S = \sigma_{A=B}(R \times S)$

**示例**（学生表与选课表按学号连接）：

**输入**：

- **R**（Student）：
    
    |   |   |
    |---|---|
    |Sno|Sname|
    |201215121|李勇|
    
- **S**（SC）：
    
    |   |   |   |
    |---|---|---|
    |Sno|Cno|Grade|
    |201215121|1|92|
    

**输出**：

|   |   |   |   |
|---|---|---|---|
|Sno|Sname|Cno|Grade|
|201215121|李勇|1|92|

### (2) 自然连接（Natural Join）

**公式**：自动匹配同名属性并去重。

$R \bowtie S = \pi_{R.*, S.\text{非公共属性}}(\sigma_{R.公共属性=S.公共属性}(R \times S))$

**示例**（自动按 `Sno` 连接）：

**输出**：同上（等值连接结果，但仅保留一个 `Sno` 列）。

### (3) 外连接（Outer Join）

- **左外连接**：保留左表所有元组，右表无匹配则填 `NULL`
- **右外连接**：保留右表所有元组
- **全外连接**：保留所有元组

---

### 4. 除（Division）

**定义**：找出与另一关系所有元组均关联的元组。

**数学表示**：

$R \div S = \{ t \mid t \in \pi_{X}(R) \ \land \ \forall s \in S, (t, s) \in R \}$

- **X**：R 中不包含 S 属性的部分

**示例**（查询选修所有课程的学生）：

1. **SC 表**（选课记录）：
    
    |   |   |
    |---|---|
    |Sno|Cno|
    |201215121|1|
    |201215121|2|
    |201215122|2|
    
2. **Course 表**（所有课程）：  
    Cno12  
    
    ---
    
    ---
    
    ---
    
3. **结果**：  
    Sno201215121  
    
    ---
    
    ---
    

---

### 组合应用示例

**查询选修“数据库”课程的学生姓名**：

1. $\text{临时表} K = \pi_{\text{Cno}}(\sigma_{\text{Cname}='数据库'}(\text{Course}))$
2. $\pi_{\text{Sname}}(\text{Student} \bowtie (\sigma_{\text{Cno} \in K}(\text{SC})))$

---

### 关键特性

|   |   |   |   |
|---|---|---|---|
|运算|操作方向|去重|实际应用场景|
|选择|水平|否|筛选满足条件的行（如 WHERE）|
|投影|垂直|是|提取特定列（如 SELECT）|
|连接|混合|是|多表关联查询（如 JOIN）|
|除|混合|是|全称量词查询（如 ∀）|

专门关系运算是 SQL 的数学基础，通过组合这些操作可实现复杂查询逻辑。