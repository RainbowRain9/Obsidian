---
命名: __4.5 路由选择协议
课程:
  - "[[第4章 网络层]]"
状态: 完成
执行人: 蔡蔡鸿宇
时间安排: Invalid date
待解决问题: 待解决:[ 0 ]
created: 2025-05-19T08:58
updated: 2025-05-19T09:05
---

# 4.5 路由选择协议

路由选择是指选择通过互连网络从源节点向目的节点传输信息的通道，信息至少通过一个中间节点。本节主要讨论路由表中的路由如何选择中间节点，从而选择一条源节点到目的节点的路由。

## 4.5.1 路由选择协议的基本概念

### 最佳路径

- **定义**: 路由选择协议的目标是选择“最佳路径”。
- **特点**: 所谓“最佳”是相对于某一种特定要求下得出的较为合理的选择。不同的协议可能使用不同的度量标准（metric）来衡量路径的“好坏”。

### 分层次的路由协议

- **定义**: 互联网规模巨大，路由表不可能包含所有网络的信息。为了应对规模问题，路由选择被组织成层次结构。
- **自治系统AS (autonomous system)**: 互联网被划分为多个自治系统。一个自治系统是指由某个单位（例如大学、公司或ISP）管理，使用统一的路由选择策略的网络集合。

### 外部网关协议与内部网关协议

- **外部网关协议 EGP (External Gateway Protocol)**:
    - **定义**: 用于不同自治系统（AS）之间交换路由信息的协议。
    - **示例**: 目前使用最多的外部网关协议是BGP的版本4 (BGP-4)。
- **内部网关协议 IGP (Interior Gateway Protocol)**:
    - **定义**: 用于同一个自治系统内部交换路由信息的协议。源主机和目的主机处于同一个自治系统中时使用。
    - **示例**: 目前使用最多的内部网关协议是RIP和OSPF协议。

## 4.5.2 静态路由

### 定义

- 静态路由表是系统管理员在系统安装时根据网络配置情况预先设定的路由信息。

### 特点

- **不可变性**: 一旦设定好后，不会随未来网络结构动态改变而自行调整。
- **维护**: 需要人工配置和维护。
- **优点**: 配置简单，适用于小型且网络拓扑变化不大的环境。
- **缺点**: 无法适应网络拓扑变化，不适用于大型或动态变化的网络。

## 4.5.3 动态路由

### 定义

- 动态路由表是路由器根据网络系统的实时状态，通过自学习的方式自动调整的路由信息。

### 特点

- **自适应性**: 在网络拓扑发生改变时，根据采用的路由算法自动计算数据分组合理的传输路径。
- **维护**: 路由器之间通过路由选择协议自动交换信息并更新路由表。
- **优点**: 能适应网络拓扑变化，适用于大型和动态变化的网络。
- **缺点**: 配置相对复杂，需要运行路由协议，消耗一定的系统资源。

### 内部网关协议 (IGP) - RIP

- **定义**: RIP (Routing Information Protocol) 是内部网关协议 IGP 中最早得到广泛使用的协议。
    
- **工作原理**:
    
    - RIP是一种**分布式**的基于**距离向量**的路由选择协议。
    - RIP协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录。
    - 它通过与相邻路由器交换信息来学习整个网络的路由。
- **“距离”的定义**:
    
    - RIP协议中的“距离”也称为**“跳数” (hop count)**。
    - 从一个路由器到直接连接的网络的距离定义为1。
    - 从一个路由器到非直接连接的网络的距离定义为所经过的路由器数加1。每经过一个路由器，跳数就加1。
    - 这里的“距离”实际上指的是“**最短距离**”。
    - RIP认为一个好的路由就是它通过的路由器的数目少，即“距离短”。
    - RIP限制一条路径最多只能包含**15个路由器**。
    - “距离”的最大值为**16**时即相当于**不可达**。
    - 可见RIP只适用于**小型互联网**。
    - RIP不能在两个网络之间同时使用多条路由，即使存在低时延但路由器较多的路由，它也只选择跳数最少的路由。
- **RIP协议的三个要点**:
    
    - 仅和**相邻路由器**交换信息。
    - 交换的信息是当前本路由器所知道的**全部信息**，即自己的路由表。
    - 按**固定的时间间隔**交换路由信息，例如，每隔30秒。
- **距离向量算法 (简述)**:
    
    - 当路由器收到相邻路由器（设地址为X）发来的RIP报文时，它会执行以下步骤来更新自己的路由表:
    1. 修改收到的RIP报文中的所有项目：把“下一跳”字段地址改为X，所有“距离”字段值加1。
    2. 对修改后的报文中的每一个项目，检查目的网络。
        - 如果目的网络不在自己的路由表中，则将该项目加到路由表中。
        - 如果目的网络在路由表中：
            - 如果下一跳是同一个路由器X，则用收到的项目替换原路由表中的项目。
            - 如果下一跳不是X：
                - 如果收到的项目中的距离小于路由表中的距离，则更新路由表中的该项目。
                - 否则，不作任何改变。
    3. 如果在3分钟内没有收到相邻路由器的更新路由表，则将该相邻路由器记为不可达，距离设为16。
- **路由表更新示例 (【例4-5】)**:
    
    - 假设路由器 R6 收到相邻路由器 R4 发来的路由更新信息。
    - **路由器 R6 的原路由表**: | 目的网络 | 距离 | 下一跳路由器 | | -------- | ---- | ------------ | | Net2 | 3 | R4 | | Net3 | 4 | R5 | |... |... |... |
    - **R4 发来的路由更新信息**: | 目的网络 | 距离 | 下一跳路由器 | | -------- | ---- | ------------ | | Net1 | 3 | R1 | | Net2 | 4 | R2 | | Net3 | 1 | 直接交付 |
    - **修改 R4 发来的报文 (距离加1，下一跳改为 R4)**: | 目的网络 | 距离 | 下一跳路由器 | | -------- | ---- | ------------ | | Net1 | 4 | R4 | | Net2 | 5 | R4 | | Net3 | 2 | R4 | |... |... |... |
    - **路由器 R6 更新后的路由表**:
        - 对于Net1: 原路由表没有，添加。
        - 对于Net2: 原路由表有，下一跳同为R4，距离5 > 3，不更新。
        - 对于Net3: 原路由表有，下一跳不同 (R5 vs R4)，距离2 < 4，更新为距离2，下一跳R4。 | 目的网络 | 距离 | 下一跳路由器 | | -------- | ---- | ------------ | | Net1 | 4 | R4 | | Net2 | 3 | R4 | | Net3 | 2 | R4 | |... |... |... |
- **RIP协议的优缺点**:
    
    - **优点**:
        - 实现简单。
        - 开销较小。
    - **缺点**:
        - 收敛速度慢: 当网络出现故障时，信息传送到所有路由器需要较长时间（存在“坏消息传得慢”问题）。
        - 规模限制: 限制了网络的规模，最大距离为15，16不可达。
        - 开销随规模增加: 路由器之间交换完整的路由表，网络规模越大，开销越大。
        - 路径选择不灵活: 只基于跳数，不考虑链路的其他属性如带宽、时延。

### 内部网关协议 (IGP) - OSPF

- **定义**: OSPF (Open Shortest Path First) 协议是另一种广泛使用的内部网关协议 IGP。
    
- **基本特点**:
    
    - “**开放**”：表明协议不是受某一家厂商控制，而是公开发表的。
    - “**最短路径优先**”：因为它使用了 Dijkstra 提出的最短路径算法 SPF (Shortest Path First)。
    - 是一种**分布式**的**链路状态**协议。
- **OSPF的三个要点**:
    
    - 向**本自治系统中所有路由器**发送信息，使用**洪泛法**。
    - 发送的信息是与本路由器**相邻的所有路由器的链路状态**。
        - “链路状态”：说明本路由器都和哪些路由器相邻，以及该链路的“**度量**”(metric)。度量可以是费用、时延、带宽等。
    - 只有当**链路状态发生变化时**，路由器才用洪泛法向所有路由器发送此信息。
- **OSPF 的区域(area)**:
    
    - 为了使OSPF能够用于规模很大的网络，OSPF将一个自治系统再划分为若干个更小的范围，叫作**区域**。
    - 每一个区域都有一个32位的区域标识符（用点分十进制表示）。
    - 区域也不能太大，在一个区域内的路由器最好不超过**200个**。
    - OSPF划分为两种不同的区域:
        - **主干区域 (Backbone Area)**: 区域标识符为0.0.0.0。用于连接其他非骨干区域。
        - **非骨干区域**: 其他区域。非骨干区域中的路由器必须通过主干区域才能与其他非骨干区域通信。
- **OSPF的优缺点**:
    
    - **优点**:
        - 收敛速度快: 链路状态发生变化时，路由器立即洪泛更新信息.
        - 支持大型网络: 通过划分区域来降低路由表的规模和更新开销.
        - 路由选择灵活: 基于链路的度量进行路径计算，度量可以反映链路的多种属性 (如带宽、时延).
        - 支持同时使用多条等价最优路径 [补充，非原文直接提及，但基于SPF算法特性].
    - **缺点**:
        - 实现复杂: 协议机制比RIP复杂 [补充，非原文直接提及].
        - 计算开销大: 路由器需要运行SPF算法计算最短路径树.
        - 对系统资源要求较高: 需要存储链路状态数据库 [补充，非原文直接提及].

---
# 问题

**Q1: 什么是路由选择？它在网络层中扮演什么角色？**

**A1:** 根据源文件，路由选择是指选择通过互连网络从源节点向目的节点传输信息的通道。在这个过程中，信息至少会通过一个中间节点。简而言之，路由选择协议主要解决如何选择中间节点的问题，从而确定一条从源节点到目的节点的路径。这正是网络层（在五层协议体系结构中位于运输层和数据链路层之间）的核心功能之一，确保数据包能够被正确地转发到目的地。

**Q2: 路由选择协议的目标是什么？所谓的“最佳路径”该如何理解？**

**A2:** 路由选择协议的基本概念之一是选择“最佳路径”。然而，“最佳”并非绝对，它只能是相对于某种特定要求下得出的较为合理的选择。不同的路由选择协议可能会使用不同的标准（度量，metric）来衡量路径的优劣，例如 RIP 使用跳数，而 OSPF 可以使用费用、时延、带宽等。

**Q3: 互联网的规模巨大，路由协议是如何应对这一挑战的？**

**A3:** 为了处理互联网巨大的规模，路由选择被设计成一个分层次的体系结构。互联网被划分为多个自治系统（Autonomous System, AS）。一个自治系统通常由某个单位（如大学、公司或 ISP）管理，并在其内部采用统一的路由选择策略。这种分层结构有助于限制路由信息的泛洪范围，降低单个路由器所需的路由信息量。

**Q4: 分层次的路由协议体系中，AS 之间和 AS 内部的路由信息交换分别使用什么类型的协议？请举例说明。**

**A4:** 在分层次的路由体系中，存在两种主要类型的路由协议：

1. **外部网关协议 (External Gateway Protocol, EGP)**：这种协议用于不同自治系统（AS）之间交换路由信息。目前使用最多的外部网关协议是 BGP 的版本 4 (BGP-4)。
2. **内部网关协议 (Interior Gateway Protocol, IGP)**：这种协议用于同一个自治系统内部交换路由信息。当源主机和目的主机处于同一个自治系统中时，就会使用内部网关协议。目前使用最多的内部网关协议是 RIP 和 OSPF。

**Q5: 什么是静态路由？它的特点是什么？**

**A5:** 静态路由是指路由表中的路由信息是系统管理员在系统安装时根据网络配置情况预先设定好的。它的主要特点是设定后就不会随未来网络结构的动态改变而自行调整。

- **优点**: 配置简单，对系统资源消耗少，适用于网络拓扑结构相对稳定且规模较小的环境。
- **缺点**: 无法自动适应网络拓扑变化，当网络发生故障或变化时，需要人工干预修改路由表，不适合大型或动态变化的复杂网络。

**Q6: 什么是动态路由？它的特点是什么？**

**A6:** 动态路由是指路由表中的路由信息是路由器根据网络系统的实时状态，通过自学习的方式自动调整的。它的主要特点是在网络拓扑发生改变时，能够根据采用的路由算法自动计算数据分组合理的传输路径。

- **优点**: 能够自动适应网络拓扑变化，提高网络的鲁棒性，适用于大型和动态变化的网络。
- **缺点**: 配置相对复杂，需要路由器之间运行路由协议交换信息并进行计算，会消耗一定的系统资源（CPU、内存、带宽）。

**Q7: 请详细介绍一下内部网关协议 RIP 的工作原理和特点。**

**A7:** 路由信息协议 RIP (Routing Information Protocol) 是内部网关协议 IGP 中最早得到广泛使用的协议。

- **工作原理**: RIP 是一种**分布式**的基于**距离向量**的路由选择协议。它要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录。路由器通过与相邻路由器交换信息来逐步学习整个网络的路由。
- **“距离”的定义**: 在 RIP 协议中，“距离”被称为**“跳数” (hop count)**。从一个路由器到直接连接的网络的距离定义为 1。从一个路由器到非直接连接的网络的距离定义为所经过的路由器数加 1。每经过一个路由器，跳数就加 1。这里的“距离”实际上指的是“最短距离”。RIP 认为一个好的路由就是通过的路由器数目少，即“距离短”。
- **规模限制**: RIP 协议限制一条路径最多只能包含 **15 个路由器**。当“距离”的最大值为 **16** 时，就表示**不可达**。因此，RIP 只适用于**小型互联网**。
- **路径选择**: RIP 不能在两个网络之间同时使用多条路由，即使存在低时延但路由器较多的路由，它也只选择跳数最少的路由（即最短路由）。

**Q8: RIP 协议有哪三个重要的要点？**

**A8:** RIP 协议的三个重要要点是:

1. 仅和**相邻路由器**交换信息。
2. 交换的信息是当前本路由器所知道的**全部信息**，也就是它自己的路由表。
3. 按**固定的时间间隔**交换路由信息，例如每隔 30 秒。

**Q9: 请简述 RIP 的距离向量算法是如何工作的，以及路由器如何根据收到的信息更新路由表？**

**A9:** 距离向量算法的工作原理如下:

当路由器收到相邻路由器（假设其地址为 X）发来的 RIP 报文时，它会执行以下步骤来更新自己的路由表:

1. 修改收到的 RIP 报文中的所有项目：把“下一跳”字段地址都改为 X，并把所有的“距离”字段的值加 1。
2. 对修改后的 RIP 报文中的每一个项目，检查目的网络:
    - 如果目的网络不在自己的路由表中，则将该项目加到路由表中。
    - 如果目的网络在路由表中:
        - 如果下一跳字段给出的路由器地址是同一个路由器 X，则用收到的项目替换原路由表中的项目。
        - 如果下一跳不是 X:
            - 如果收到的项目中的距离小于路由表中的距离，则更新路由表中的该项目。
            - 否则，不作任何改变。
3. 若在 3 分钟内还没有收到相邻路由器的更新路由表，则将该相邻路由器记为不可达路由器，即将距离置为 16（距离为 16 表示不可达）。
4. 最后，返回。

源文件中的【例4-5】和另一个【例】路由表更新详细演示了这个更新过程，例如在【例4-5】中，路由器 R6 收到 R4 发来的更新，对于目的网络 Net3：R6 原路由表通过 R5 到 Net3 的距离是 4，R4 告诉 R6 它到 Net3 的距离是 1，经过 R4 到 Net3 的距离就是 1+1=2。因为 2 小于 R6 原来的距离 4，R6 就会更新路由表，将到 Net3 的距离改为 2，下一跳改为 R4。

**Q10: RIP 协议有哪些优缺点？**

**A10:** RIP 协议的优缺点如下:

- **优点**:
    - 实现简单。
    - 开销较小。
- **缺点**:
    - 收敛速度慢: 当网络出现故障时，由于“坏消息传得慢”的问题，信息传送到所有路由器需要较长时间。
    - 规模限制: 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
    - 开销随规模增加: 路由器之间交换的是完整的路由表，网络规模越大，交换的路由信息量越大，开销也就增加。
    - 路径选择不灵活: 只基于跳数作为度量，不考虑链路的其他属性，如带宽或时延。

**Q11: 请详细介绍一下内部网关协议 OSPF 的工作原理和特点。**

**A11:** OSPF (Open Shortest Path First) 协议是另一种广泛使用的内部网关协议 IGP。

- **基本特点**:
    
    - “**开放**”：意味着协议不是受某一家厂商控制，而是公开发表的。
    - “**最短路径优先**”：因为它使用了 Dijkstra 提出的最短路径算法 SPF (Shortest Path First)。OSPF 只是一个协议的名字，它并不表示其他的路由选择协议不是“最短路径优先”。
    - 是一种**分布式**的**链路状态**协议。
- **OSPF 的三个要点**:
    
    1. 向**本自治系统中所有路由器**发送信息，这里使用的是**洪泛法**。
    2. 发送的信息是与本路由器**相邻的所有路由器的链路状态**，但这只是路由器所知道的部分信息。“链路状态”就是说明本路由器都和哪些路由器相邻，以及该链路的“**度量**”(metric)。度量可以是费用、时延、带宽等。
    3. 只有当**链路状态发生变化时**，路由器才用洪泛法向所有路由器发送此信息。

**Q12: OSPF 协议是如何处理大型网络的规模问题的？请解释 OSPF 的区域概念。**

**A12:** 为了使 OSPF 能够用于规模很大的网络，OSPF 将一个自治系统进一步划分为若干个更小的范围，称作**区域 (area)**。

- 每一个区域都有一个 32 位的区域标识符（用点分十进制表示）。
- 区域也不能太大，建议在一个区域内的路由器最好不超过 **200 个**。
- OSPF 划分出两种不同的区域:
    - **主干区域 (Backbone Area)**: 其区域标识符为 0.0.0.0。主干区域的目的是连接其他非骨干区域。非骨干区域中的路由器必须通过主干区域才能与其他非骨干区域通信。
    - **非骨干区域**: 其他区域。

这种区域划分的机制可以限制链路状态信息的洪泛范围在区域内部，减小了路由器需要维护的链路状态数据库规模，也降低了路由计算的复杂度。

**Q13: OSPF 协议有哪些优缺点？与 RIP 相比，它有哪些改进？**

**A13:** OSPF 协议的优缺点如下：

- **优点**:
    - 收敛速度快: OSPF 在链路状态发生变化时会立即洪泛更新信息，而非像 RIP 那样等待定时更新，这使得网络故障信息的传播更快，收敛速度通常比 RIP 快得多。
    - 支持大型网络: 通过划分区域，OSPF 可以有效地管理大规模网络的路由信息，降低路由表的规模和更新开销。
    - 路由选择灵活: OSPF 基于链路的度量（可以是费用、时延、带宽等）进行路径计算，这使得路由选择可以更灵活地反映网络的实际状况，而不仅仅是简单的跳数。
    - 支持同时使用多条等价最优路径（基于 SPF 算法的特性，原文未直接提及此点，但这是链路状态算法的优势）。
- **缺点**:
    - 实现复杂: OSPF 协议的机制比 RIP 要复杂得多。
    - 计算开销大: 路由器需要维护链路状态数据库，并运行 SPF 算法（Dijkstra 算法）来计算到达所有目的地的最短路径树，这需要更多的 CPU 和内存资源。
    - 对系统资源要求较高: 路由器需要存储整个区域的链路状态数据库。

总的来说，OSPF 相对于 RIP 在收敛速度、对大型网络的适应性以及路由选择的灵活性方面都有显著改进，但也增加了协议的复杂性和对路由器系统资源的消耗。