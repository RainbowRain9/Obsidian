---
命名: __3.4 点对点协议PPP
课程:
  - "[[第3章 数据链路层]]"
状态: 完成
执行人: 蔡蔡鸿宇
时间安排: Invalid date
待解决问题: 待解决:[ 0 ]
created: 2025-04-07T08:27
updated: 2025-04-07T09:01
---

# 3.4 点对点协议PPP

## 3.4.1 PPP协议概述
PPP（Point-to-Point Protocol）是**广泛使用的数据链路层协议**，主要应用于拨号接入、专线连接等点对点通信场景[^1]。

### 主要特点
1. **简单性**：轻量级协议设计
2. **封装成帧**：支持多种网络层协议封装
3. **透明传输**：采用字节填充/零比特填充技术
4. **差错检测**：使用CRC校验机制
5. **连接检测**：支持链路状态监测

## 3.4.2 PPP帧格式
PPP帧结构包含以下字段：

| 字段 | 长度 | 说明 |
|------|------|------|
| 标志(F) | 1字节 | 固定为0x7E（帧定界符） |
| 地址(A) | 1字节 | 固定为0xFF（广播地址） |
| 控制(C) | 1字节 | 固定为0x03（无编号帧） |
| 协议 | 2字节 | 标识封装的数据类型 |
| 信息 | 可变 | 上层协议数据 |
| FCS | 2/4字节 | 帧校验序列 |

**透明传输实现**：
- 异步传输采用**字节填充**：
  ```cpp
  0x7E → 替换为 0x7D 0x5E (帧标志转义)
  0x7D → 替换为 0x7D 0x5D (转义符自身转义)
  0x07 → 替换为 0x7D 0x27 (控制字符转义)
  ```
- 同步传输采用**零比特填充**：
  ```
  发送端：连续5个1后插入0
  接收端：连续5个1后删除0
  ```

### PPP协议中的字节填充法

PPP协议在异步传输时（如通过串行线路）使用**字节填充法**来实现**透明传输**。透明传输的意思是让任何数据都能作为PPP帧的有效载荷传输，而不会被误认为是帧的起始或结束标志或其他控制字符。

PPP的帧格式如下：

- 标志字段（Flag）：`0x7E`（表示帧的开始和结束）
- 地址字段（Address）：`0xFF`
- 控制字段（Control）：`0x03`
- 协议字段（Protocol）
- 数据部分（可变长度）
- FCS（帧校验序列）
- 标志字段（Flag）：`0x7E`

为了避免数据部分中出现`0x7E`被误认为是帧的结束标志，PPP协议规定：

1. 如果数据部分中出现`0x7E`，则将其替换为`0x7D 0x5E`（转义字符`0x7D`后跟`0x5E`）。
2. 如果数据部分中出现`0x7D`，则将其替换为`0x7D 0x5D`（转义字符`0x7D`后跟`0x5D`）。
3. 如果数据部分中出现ASCII控制字符（值小于`0x20`），则在该字符前插入`0x7D`，并将该字符与`0x20`异或。例如，`0x01`会被替换为`0x7D 0x21`。

### 题目解析

题目给出的PPP帧数据部分是：`7D 5E FE 7D 27 7D 5D 7D 5D 65 7D 5E`。我们需要逆向操作（即解填充）来得到真正的数据部分。

#### 解填充规则：

1. 遇到`0x7D 0x5E`：替换为`0x7E`。
2. 遇到`0x7D 0x5D`：替换为`0x7D`。
3. 遇到`0x7D`后跟其他字节（如`0x7D 0x27`）：将该字节与`0x20`异或，得到原始字符（`0x27 ^ 0x20 = 0x07`）。

#### 逐步解填充：

原始数据：`7D 5E FE 7D 27 7D 5D 7D 5D 65 7D 5E`

1. 第一个字节是`0x7D`，后面是`0x5E`：
    - `0x7D 0x5E` → `0x7E`
    - 当前数据：`7E FE 7D 27 7D 5D 7D 5D 65 7D 5E`
2. 接下来是`0xFE`，不是`0x7D`，直接保留：
    - `0xFE`
    - 当前数据：`7E FE 7D 27 7D 5D 7D 5D 65 7D 5E`
3. 下一个是`0x7D`，后面是`0x27`：
    - `0x7D 0x27` → `0x27 ^ 0x20 = 0x07`
    - 当前数据：`7E FE 07 7D 5D 7D 5D 65 7D 5E`
4. 下一个是`0x7D`，后面是`0x5D`：
    - `0x7D 0x5D` → `0x7D`
    - 当前数据：`7E FE 07 7D 7D 5D 65 7D 5E`
5. 下一个是`0x7D`，后面是`0x5D`：
    - `0x7D 0x5D` → `0x7D`
    - 当前数据：`7E FE 07 7D 7D 65 7D 5E`
6. 下一个是`0x65`，不是`0x7D`，直接保留：
    - `0x65`
    - 当前数据：`7E FE 07 7D 7D 65 7D 5E`
7. 最后是`0x7D 0x5E`：
    - `0x7D 0x5E` → `0x7E`
    - 当前数据：`7E FE 07 7D 7D 65 7E`

#### 真正的数据部分：

将解填充后的数据拼接起来： `7E FE 07 7D 7D 65 7E`

### 验证

为了验证正确性，我们可以尝试将解填充后的数据重新填充，看是否能得到原始数据： 原始数据（解填充后）：`7E FE 07 7D 7D 65 7E`

1. `0x7E` → `0x7D 0x5E`
2. `0xFE` → 直接保留
3. `0x07` → `0x7D 0x27`（因为`0x07`是控制字符，`0x07 ^ 0x20 = 0x27`）
4. `0x7D` → `0x7D 0x5D`
5. `0x7D` → `0x7D 0x5D`
6. `0x65` → 直接保留
7. `0x7E` → `0x7D 0x5E`

填充后： `7D 5E FE 7D 27 7D 5D 7D 5D 65 7D 5E` 这与题目给出的数据一致，验证了解填充的正确性。

### 可能的疑问

为什么`0x7D 0x27`会被解填充为`0x07`？

- 因为`0x27`是`0x7D`后跟的字节，且`0x27`不是`0x5E`或`0x5D`，所以按照规则：
    - `0x27 ^ 0x20 = 0x07`（`0x27`是`'`'的ASCII，`0x20`是空格，异或后得到`0x07`，即BEL控制字符）。

### 最终答案

真正的数据部分是： **7E FE 07 7D 7D 65 7E**

## 3.4.3 PPP协议组成
PPP协议包含三个核心组件[^2]：

### 1. 封装方法
- 定义IP数据报在串行链路的封装格式
- 支持的协议类型：
  - 0x0021：IP数据报
  - 0xC021：LCP分组
  - 0x8021：NCP分组

### 2. 链路控制协议(LCP)
功能：
- 链路建立、配置和测试
- 协商参数：
  - 最大接收单元(MRU)
  - 认证协议选择
  - 魔术字（检测环路）

### 3. 网络控制协议(NCP)
- 协议族（如IPCP、IPv6CP）
- 动态分配IP地址
- 配置网络层参数

## 3.4.4 PPP工作原理
### 状态转移过程
```mermaid
graph LR
    A[链路静止] -->|物理连接| B[链路建立]
    B -->|LCP协商| C[认证]
    C -->|认证成功| D[网络层协议]
    D -->|NCP配置| E[链路打开]
    E -->|断开请求| F[链路终止]
```

### 典型工作流程
1. **物理连接建立**：调制解调器完成握手
2. **LCP协商**：
   - 交换配置分组
   - 协商认证方式（PAP/CHAP）
3. **认证阶段**（可选）
4. **NCP配置**：
   - 分配临时IP地址
   - 配置DNS等参数
5. **数据传输**
6. **连接释放**：
   - 发送Terminate帧
   - 依次释放NCP、LCP和物理连接

## 3.4.5 PPP认证机制
| 协议 | 特点 | 安全性 |
|------|------|--------|
| PAP | 明文传输密码 | 低 |
| CHAP | 挑战-响应机制 | 高 |

**CHAP认证过程**：
1. 认证方发送Challenge
2. 被认证方计算Hash(Challenge+Password)
3. 认证方验证响应结果

[^1]: 计算机网络-第3章数据链路层.pptx，PPP协议基础原理
[^2]: 计算机网络-第3章数据链路层.pdf，PPP协议组成和工作状态