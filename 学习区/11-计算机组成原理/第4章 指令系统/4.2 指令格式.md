---
命名: __4.2 指令格式
课程:
  - "[[第4章 指令系统]]"
状态: 完成
执行人: 蔡蔡鸿宇
时间安排: Invalid date
待解决问题: 待解决:[ 0 ]
created: 2025-05-13T17:36
updated: 2025-05-13T18:04
---

# 4.2 指令格式

## 4.2 指令格式概述

### 定义与组成

- **指令字**（指令）是表示一条指令的机器字。
- **指令格式**则是指令字用二进制代码表示的**结构形式**。
- 机器执行一条指令所必须的全部信息都必须明显或隐含地在指令中给出。这些信息通常包括：
    - **操作类型**：表示指令应进行什么性质的操作。
    - **源操作数地址**：参加运算的一个或若干个操作数的地址（可能存放在内存单元或寄存器中）。
    - **目的操作数地址**：运算结果存放的地址（可能存放在内存单元或寄存器中）。
    - **下一条指令的存放地址**：程序正常顺序执行或发生转移时下一条指令在内存中的地址。

### 指令字结构示意

指令字通常由**操作码**字段和**地址码**字段组成：

```
+-----------+---------------+
|  操 作 码 |   地 址 码    |
+-----------+---------------+
```

- **操作码（OP）**：指明指令的操作性质。
- **地址码（Address Code）**：指明操作数的地址或下一条指令的地址。

## 4.2.1 操作码

### 定义与功能

- 每一条指令都有一个**操作码**，表示该指令应进行什么性质的**操作**。
- 不同的指令用操作码字段的**不同编码**表示。

### 长度确定

- 操作码字段的位数一般取决于计算机**指令系统的规模**（即指令的条数）。
- 一个特定的机器的指令系统，不同指令字中操作码字段和地址码字段的长度可以相同，也可以不同。

### 类型

- **等长操作码**（固定长度操作码）：

    - 定义：操作码所占的二进制位数**固定不变**。
    - 特点：如果系统中所有指令的操作码都用n位二进制数表示，则系统中的指令条数不会超过 $2^n$ 条。
    - 优点：有利于**简化硬件设计**，**减少指令译码时间**。
    - 应用：广泛用于**字长较长**的计算机的指令系统中。
- **可变长度操作码**：

    - 定义：不同的指令的**操作码长度不同**。
    - 实现技术：主要采用**操作码扩展技术**。
        - **核心思想**：地址数少的指令使用**较长**的操作码，地址数多的指令使用**较短**的操作码；或者使用频度高的指令分配**短**的操作码，使用频度低的指令分配**较长**的操作码。
    - 优点：
        - 有效**缩短操作码的平均长度**，节省存储空间。
        - **缩短常用指令的译码时间**，提高程序的运行速度。
    - 缺点：**指令译码系统**比等长操作码复杂。
    - 应用：在**字长较短**的微型机中应用广泛。
    - 设计：操作码的长度应与地址码的长度以及整个指令长度**综合考虑**。

## 4.2.2 地址码

### 定义与功能

- 指令中的**地址码**用来指出该指令的**源操作数地址**（0至2个）、**目标操作数**（结果）地址，以及**下一条指令的地址**。

### 操作数的存放位置

操作数可以存放在：

- 主存单元。
- CPU内部数据寄存器。
- I/O设备接口内的寄存器。

### 指令分类（按地址码个数）

- 如果一条指令中有n个操作数地址（在指令字中明显给出），则将该指令称为**n操作数指令**或**n地址指令**。
- 地址码字段的表示：
    - OP: 操作码
    - A1：第一地址码，存放被操作数（第一源操作数）
    - A2：第二地址码，存放操作数（第二源操作数）
    - A3：第三地址码，存放操作结果
    - A4：第四地址码，存放下条要执行指令的地址

#### 四地址指令

- 指令格式： `OP A1 A2 A3 A4`
- 操作：（A1）OP（A2）→ A3，下一条指令地址由A4给出.
- 地址范围：指令可直接寻址的地址范围与地址字段的位数有关。例如，指令字长32位，操作码占8位，4个地址段各占6位，则指令的直接寻址范围为 $2^6 = 64$。
- 访存次数：如果地址字段均指示主存的地址，则一条四地址指令执行时共需访存**四次**（取指令，取两个源操作数，存结果，取下一条指令）。
- 优点：指令直观易懂，后续指令的地址可任意安排。
- 缺点：指令长度长。

#### 三地址指令

- 指令格式： `OP A1 A2 A3`
- 操作：（A1）OP（A2）→ A3。
- 下一条指令地址：通常情况下，非转移类指令的下一条指令地址是本条指令在内存中的存放首地址加上本条指令的长度。

#### 二地址指令

- 指令格式： `OP A1 A2`
- 操作类型：
    - **双操作数操作**：(A1) OP (A2) → A1。此时A1既作被操作数（第一源操作数）地址，又作目的操作数地址。A2作操作数（第二源操作数）地址。
    - **单操作数操作**：OP (A1) → A2。此时A1作被操作数（源操作数）地址。A2作操作数（目的操作数）地址。

#### 一地址指令（单操作数指令）

- 指令格式： `OP A1`
- 操作类型：
    - **双操作数操作**：(A1) OP (X) → X。A1作第一源操作数地址。X作第二源操作数地址和目的操作数地址，X通常**隐含**使用寄存器或堆栈寻址。
    - **单操作数操作**：OP (A1) → A1。A1既作被操作数地址，又作目的操作数地址。

#### 零地址指令

- 指令格式： `OP`
- 特点：指令字中**只有操作码**，没有地址码。
- 应用场景：
    - **无需操作数的指令**，如空操作、停机等。
    - **运算的操作数地址全部隐含**。源操作数和结果隐含使用寄存器、堆栈或特定操作数。

### 地址码个数对指令系统性能的影响

- 早期：多采用二地址指令和一地址指令。
- 随着处理机字长和指令字长的增加，三地址指令已很普遍。
- 地址多的指令：
    - 功能强，使用灵活。
    - 占用的存放单元多，执行时间长。
- 隐含地址的指令：
    - 节省了指令地址字段。
    - 牺牲了灵活性。
- 一个实际的指令系统往往**混合使用多种指令格式**。

### 双操作数运算指令的类型（按操作数位置）

- **存储器-存储器（SS）型指令**：参与运算的操作数都放在内存中。机器执行SS型指令需多次访问内存。
- **寄存器-寄存器（RR）型指令**：参与运算的操作数都放CPU内部的数据寄存器中。机器执行RR型指令速度快，但需要多个寄存器.
- **寄存器-存储器（RS）型指令**：执行RS型指令时，既要访存，又要访问寄存器。

## 4.2.3 指令字长度

### 定义

- **机器字长**（简称字长）：指计算机能直接处理的**二进制数据的位数**，通常是CPU运算器的字长。字长越长，计算机的运算精度越高。为便于处理字符数据及尽可能地利用存储空间，一般把机器字长定为字节长度的整数倍。
- **指令字长**：一个指令字中包含的**二进制代码的位数**。
- 决定因素：指令字长取决于操作码的长度、操作数地址的长度和操作数地址的个数。

### 与机器字长的关系

- 通常指令字长等于机器字长的**整数倍**。
- 如果机器字较长，指令字长也可是机器字长的一半的整数倍。
- 根据指令字长等于多少机器字长，可以将机器指令分为：
    - **单字长指令**：指令字长等于机器字长。
    - **半字长指令**：指令字长等于半个机器字长。
    - **双字长指令**：指令字长等于两个机器字长。
- **多字长指令**：
    - 优点：可以给操作码和地址码提供**较大的空间**。
    - 缺点：占用了较多的**内存空间**和**取指时间**。

### 指令字结构类型

- **等长指令字结构**：
    - 定义：在同一个指令系统中，所有的指令字长度都是**相等的**。
    - 特点：指令字结构简单，控制方便，实现复杂度低。
- **变长指令字结构**：
    - 定义：在一个指令系统中，各种指令字长度随指令的功能而变化。
    - 特点：指令字结构灵活，能充分利用指令字长度，但指令的控制较复杂。

## 扩展操作码示例

### 原理说明

扩展操作码是变长操作码的一种实现技术，通过将部分地址字段作为操作码的扩展位，可以在固定长度的指令字中容纳更多不同格式（特别是地址数较少）的指令。

### 示例解析（16位指令字）

假设某机器的指令长度为16位，包含4位基本操作码字段（OP）和三个4位地址字段（A1, A2, A3）。

指令格式示意图：

```
15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0
+----+----+----+----+
| OP | A1 | A2 | A3 |
+----+----+----+----+
  4位  4位  4位  4位
```

如果4位基本操作码全部用于三地址指令，只能表示 $2^4=16$ 种指令。通过扩展操作码，可以在同一16位指令字内表示更多指令种类：

- **三地址指令**：
    - 使用4位基本操作码字段的**15种**编码（例如0000～1110）表示15条三地址指令。
    - 剩余**1种**编码（例如1111）不表示具体指令，而是作为**扩展标志**，指示操作码向A1字段扩展。
- **二地址指令**：
    - 当基本操作码为扩展标志（1111）时，操作码扩展到A1字段，形成8位操作码（1111 + A1的4位）。
    - 这8位编码空间有 $2^4=16$ 种组合（因为A1有16种取值）。
    - 使用其中的**14种**编码（例如1111 0000～1111 1101）表示14条二地址指令。此时A2和A3字段仍用于地址。
    - 剩余**2种**编码（例如1111 1110和1111 1111）作为进一步扩展标志，指示操作码向A2字段扩展.
- **一地址指令**：
    - 当8位扩展操作码为进一步扩展标志（例如1111 1110或1111 1111）时，操作码扩展到A2字段，形成12位操作码（1111 + A1的4位 + A2的4位）.
    - 这12位编码空间有 $2 \times 2^4=32$ 种组合（因为A2有16种取值，前8位有两种前缀）.
    - 源资料指出，使用其中的**31种**编码（例如1111 1110 0000～1111 1111 1110）表示31条一地址指令. 此时A3字段仍用于地址.
    - 剩余**1种**编码（例如1111 1111 1111）作为最终扩展标志，指示操作码向A3字段扩展.
- **零地址指令**：
    - 当12位扩展操作码为最终扩展标志（例如1111 1111 1111）时，操作码扩展到A3字段，形成16位操作码（1111 + A1的4位 + A2的4位 + A3的4位）.
    - 这16位编码空间有 $2^4=16$ 种组合（因为A3有16种取值）.
    - 全部**16种**编码（例如1111 1111 1111 0000～1111 1111 1111 1111）都可表示16条零地址指令.

总计可定义的指令条数：15（三地址）+ 14（二地址）+ 31（一地址）+ 16（零地址）= **76条**指令.

通过这种机制，可在固定指令字长内，为地址数较少的指令提供更长的操作码空间，增加指令种类。

## 4.2.4 指令助记符

### 定义

- **指令助记符**是用于**取代机器指令的操作码部分**的一种**更具可读性的符号**.

### 目的与作用

- 计算机可以直接保存和识别机器语言（二进制代码），但这种形式对程序员来说既**繁琐又不易记忆**.
- 为了**便于书写和阅读程序**，引入了指令助记符。它用更容易理解的英文缩写或符号来代表特定的机器操作.
- 这使得程序员可以使用汇编语言（符号语言）来编写程序，提高了编程效率和可读性.
- 汇编语言程序在执行前需人工或借助汇编程序自动转换成机器语言程序执行.
- 对某一特定的机器而言，汇编语言与机器语言可以认为是**一一对应的**.

### 特点

- **可读性**：指令助记符比二进制机器码更易于理解.
- **系统相关性**：在不同的指令系统中，即使表示相同或类似的操作，所采用的助记符也可能**不相同**.

### 示例

下表展示了一些指令助记符及其对应的二进制操作码示例：

|指令|指令助记符|二进制操作码举例|
|:--|:--|:--|
|加法|ADD|001|
|减法|SUB|010|
|传送|MOV|011|
|跳转|JMP|100|
|转子|JSR|101|
|存储|STR|110|
|读数|LDA|111|

_例如，程序员编写`ADD`指令时，汇编器会将其转换为机器码`001`，由硬件执行加法操作。_

## 4.2.5 指令格式举例

### Motorola M6800/Intel 8080

- 这两种是八位微机的指令格式。
- 机器字长**8位**.
- 采用**可变字长指令结构**，包含单字长、双字长、三字长指令等多种指令.
- 内存按**字节编址**.
    - 单字长指令每执行一条指令后，指令地址加1.
    - 双字长指令或三字长指令每执行一条指令后，指令地址加2或加3.

指令格式示例：

- **单字长指令**：

    ```
    +----------+
    |  操作码  |
    +----------+
     (8位)
    ```

- **双字长指令**：

    ```
    +----------+------------+
    |  操作码  | 操作数地址 |
    +----------+------------+
     (8位)      (8位)
    ```

- **三字长指令**：

    ```
    +----------+--------------+--------------+
    |  操作码  | 操作数地址1  | 操作数地址2  |
    +----------+--------------+--------------+
     (8位)      (8位)          (8位)
    ```

### DEC PDP/11系列小型机

- 指令字长**16位**.
- 操作码字段长度**不固定**.

指令格式示例：

| 指令类型 | 15 | 14 | 13 | 12 | 11 | 10 | 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | :------------- | :- | :- | :- | :- | :- | :- | :- | :- | :- | :- | :- | :- | :- | :- | :- | :- | | 单操作数指令 | \multicolumn{10}{c|}{操作码（10位）} | \multicolumn{6}{c|}{目标地址（6位）} | | 双操作数指令 | \multicolumn{4}{c|}{操作码（4位）} | \multicolumn{6}{c|}{源地址（6位）} | \multicolumn{6}{c|}{目标地址（6位）} | | 转移指令 | \multicolumn{8}{c|}{操作码（8位）} | \multicolumn{8}{c|}{位移量（8位）} | | 转子指令 | \multicolumn{7}{c|}{操作码（7位）} | \multicolumn{9}{c|}{寄存器号} | | 子程序返回指令 | \multicolumn{13}{c|}{操作码（13位）} | \multicolumn{3}{c|}{} | | 条件码操作指令 | \multicolumn{11}{c|}{操作码（11位）} | S | N | Z | V | C |

常用的条件码：

- **CF（进位标志）**：最近的操作使最高位产生了进位。可以用来检查无符号操作数据的溢出。
- **ZF（零标志）**：最近的操作得出的结果为0.
- **SF（符号标志）**：最近的操作得到的结果为负数。
- **OF（溢出标志）**：最近的操作导致一个补码溢出——正溢出或负溢出。

### Pentium指令格式

- 指令字长**可变**：从**1字节到12字节**，还可以带前缀.

指令格式结构示意：

```
+----------+------------+---------+---------+---------+---------+------------+
| 指令前缀 | 段超越前缀 | 操作数长度超越 | 地址长度超越 | 操作码  | ModR/M字节 | SIB字节 |
+----------+------------+---------+---------+---------+---------+------------+
 0或1字节   0或1字节     0或1字节   0或1字节    1或2字节  0或1字节  0或1字节
```

```
+-----------+----------+------------+
| 位移量    | 立即数   |            |
+-----------+----------+------------+
 0,1,2,4字节 0,1,2,4字节
```

- ModR/M字节：2位Mod字段，3位Reg/Opcode字段，3位R/M字段.
- SIB字节：2位比例因子S字段，3位变址I字段，3位基址B字段.

### 指令格式分析示例

【例4-2】分析某16位计算机指令格式：

```
15         9 8 7           4 3            0
+-----------+-------------+-------------+
| OP (7位)  | 源寄存器(4位) | 目标寄存器(4位) |
+-----------+-------------+-------------+
```

答：

- (1) 单字长**二地址指令**，用于访问存储器.
- (2) 操作码字段OP为**7位**，如果采用等长操作码，可以指定 $2^7＝128$ 种操作.
- (3) 源寄存器和目标寄存器都是通用寄存器（可分别指定16个），所以是**R-R型指令**.
- (4) 常用于算术、逻辑运算类指令.

【例4-3】分析某16位计算机指令格式：

```
15         10 9          7 6           4 3            0
+-----------+-------------+-------------+-------------+
| OP (6位)  | 未用(3位)   | 源寄存器(3位) | 变址寄存器(3位) |
+-----------+-------------+-------------+-------------+

+-----------------------------+
| 位移量（16位）                |
+-----------------------------+
```

答：

- (1) **双字长二地址指令**，用于访问存储器.
- (2) 操作码字段OP为**6位**，如果采用等长操作码，可以指定 $2^6＝64$ 种操作.
- (3) 一个操作数在源寄存器（共16个）中，另一个操作数在存储器中（由变址寄存器和位移量决定），所以是**R-S型指令**.