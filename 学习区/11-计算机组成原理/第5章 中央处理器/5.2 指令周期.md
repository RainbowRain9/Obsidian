---
命名: __5.2 指令周期
课程: 
状态: 计划中
执行人: 蔡蔡鸿宇
时间安排: Invalid date
待解决问题: 待解决:[ 0 ]
created: 2025-05-20T17:54
updated: 2025-05-20T22:26
---

# 5.2 指令周期
指令周期是CPU从内存取出并执行一条指令的**时间总和**。它描述了CPU执行一条指令的整个过程，是计算机执行程序的基本单位。指令周期通常包含多个CPU周期，而每个CPU周期又由若干个时钟周期构成。

## 5.2.1 指令周期的基本概念
### 5.2.1.1 定义与关系
*   **指令周期 (Instruction Cycle)**
    *   **定义**：CPU从内存中取出一条指令并加以执行所需的时间。它等于**取指时间**与**执行时间**之和。也可以定义为连续两次发送取指令地址之间的间隔时间。
    *   **构成**：一个指令周期通常包含多个CPU周期。
*   **时钟周期 (Clock Cycle)** / **节拍脉冲 (Beat Pulse)** / **节拍周期 (Beat Cycle)** / **T周期 (T Cycle)**
    *   **定义**：计算机中**最基本**的时间单位。它是时序控制系统中最基本的定时信号。
    *   **地位**：一个指令周期由多个时钟周期构成。时钟周期通常由CPU的时钟频率决定。
*   **CPU周期 (CPU Cycle)** / **机器周期 (Machine Cycle)**
    *   **定义**：CPU与内存或I/O设备进行**一次信息交换**所需的时间。
    *   **构成**：一个CPU周期通常由若干个时钟周期组成。
    *   **现代计算机中的演变**：现代计算机已较少采用三级时序系统（主状态周期-节拍电位-节拍脉冲），机器周期的概念逐渐消失，在许多体系结构中，**机器周期已等同于时钟周期**。本章提到的CPU周期通常对应于完成一个基本操作的时间单元，可能包含多个时钟周期，但其地位低于指令周期。
*   **关系示意图**
    ```mermaid
    graph LR
        T1 --> CPU周期;
        T2 --> CPU周期;
        T3 --> CPU周期;
        T4 --> CPU周期;
        CPU周期(取指令) --> 指令周期;
        CPU周期(执行指令) --> 指令周期;
    ```
    上图简要表示了时钟周期、CPU周期和指令周期之间的包含关系。多个时钟周期构成一个CPU周期，多个CPU周期构成一个指令周期.

## 5.2.2 CPU执行方式
指令的执行方式主要影响一个指令周期内CPU如何处理不同的微操作，以及指令周期与时钟周期之间的关系。

### 5.2.2.1 单周期CPU (Single-Cycle CPU)
*   **定义**：在一个**时钟周期内**完成从指令取出到得到结果的**所有工作**。
*   **特点**：
    *   **设计方便**，时序控制简单。
    *   所有指令的执行时间都由**最长耗时指令**决定。
*   **应用情况**：由于效率较低，**较少采用**。

### 5.2.2.2 多周期CPU (Multi-Cycle CPU)
*   **定义**：将指令的执行过程**分成多个阶段**，每个阶段在一个**时钟周期内完成**。
*   **特点**：
    *   时钟周期可以**较短**，由最耗时阶段的时间决定。
    *   不同指令可以占用**不同数量**的时钟周期。
    *   允许功能部件在一条指令执行过程中被**重复使用**。

### 5.2.2.3 流水线处理器 (Pipeline Processor)
*   **定义**：在多周期CPU设计的基础上，让各个阶段的执行在时间上**重叠并行执行**。
*   **特点**：
    *   通过**时间重叠**实现**任务级并行**。
    *   大幅度改善计算机的系统性能。
    *   允许多条指令同时处于流水线的不同阶段。
    *   流水周期由**最慢的功能段**时间决定。

## 5.2.3 指令的执行过程阶段划分
一条指令的执行过程通常可以大致分为以下几个阶段：

### 5.2.3.1 概述
*   **主要阶段**：
    1.  取指阶段 (Fetch)
    2.  取操作数阶段 (Operand Fetch)
    3.  执行阶段 (Execution)

### 5.2.3.2 取指阶段 (Fetch Stage)
*   **定义**：从内存中取出当前要执行的指令，是**每条指令的第一个CPU周期**。
*   **操作步骤**：
    *   将程序计数器PC中的指令地址送入内存地址寄存器MAR。 (`PC → AR`)
    *   通过地址总线将地址送往主存。 (`AR → AB`)
    *   根据控制信号（如`RD`，读信号）从主存指定单元读取指令。 (`RD, M[AR] → DB`)
    *   主存将指令通过数据总线送入CPU的缓冲寄存器DR。 (`DB → DR`)
    *   将缓冲寄存器DR中的指令送入指令寄存器IR。 (`DR → IR`)
    *   **同时**，修改程序计数器PC的内容，使其指向下一条指令的地址。 (`PC＋δ → PC`)，其中δ通常是指令长度。
    *   对指令寄存器IR中的操作码字段进行译码测试，以便确定下一步进行何种操作。 (`ID`)
*   **涉及的部件**：程序计数器(PC)、内存地址寄存器(MAR/AR)、缓冲寄存器(DR/MDR)、指令寄存器(IR)、指令译码器(ID)、主存、地址总线、数据总线。
*   **取指过程示例**：
    ```mermaid
    graph TD
        A[PC] --> B(地址总线 AB);
        B --> C(存储器 M);
        A --> D(AR 地址寄存器);
        D --> B;
        C --> E(数据总线 DB);
        E --> F(DR 数据缓冲寄存器);
        F --> G(IR 指令寄存器);
        G --> H(ID 指令译码器);
        A -- 自增 --> A;
    ```
    微操作序列示例: `PC→AR`; `AR→AB`; `PC＋δ→PC`; `RD, M[AR]→DB`; `DB→DR`; `DR→IR`; `ID`。

### 5.2.3.3 取操作数阶段 (Operand Fetch Stage)
*   **定义**：由指令中的形式地址**计算实际操作数地址**并访问内存（如果操作数在内存中）取得操作数。
*   **条件**：只有在需要到内存取操作数的指令中才有该阶段。例如，对于寄存器-寄存器操作的指令，操作数已经在寄存器中，不需要此阶段。
*   **寻址方式的影响**：直接寻址方式和间接寻址方式的取数阶段不同，间接寻址可能需要多次访存才能最终确定操作数的有效地址。

### 5.2.3.4 执行阶段 (Execution Stage)
*   **定义**：根据指令的操作码和寻址方式，执行指令规定的各种操作，如算术运算、逻辑运算、数据传送等。
*   **特点**：
    *   因各条指令的操作不同而**复杂程度各异**。
    *   占用的时间可能**相差比较大**。
    *   涉及运算器（ALU）、通用寄存器等部件.

## 5.2.4 指令执行过程实例
以下通过几种典型的指令类型示例来进一步说明指令的执行过程.

### 5.2.4.1 无需访存取操作数的指令：RR型NOT指令
*   **功能**：对寄存器R1的内容按位取反，结果存入寄存器R0。例如：`NOT R0, R1` 表示 `~R1 → R0`。
*   **执行周期**：对于这类操作数已经在寄存器中的指令，取指阶段后直接进入执行阶段，无需独立的取操作数阶段.
    *   **取指周期**：完成将指令从内存取到IR的过程.
    *   **执行周期**：
        1.  将寄存器R1的内容送至运算器ALU的输入端.
        2.  ALU执行NOT操作.
        3.  将ALU的运算结果送至寄存器R0.

### 5.2.4.2 直接访存取操作数的指令：RS型LAD指令
*   **功能**：将内存给定单元的数据送至通用寄存器。例如：`LAD R1, 6` 表示将内存地址为6的单元内容送至寄存器R1。这是内存直接寻址方式。
*   **执行周期**：包含取指、取操作数（访存取数）和执行（数据传送）阶段.
    *   **取指周期**：完成将指令从内存取到IR的过程.
    *   **取操作数阶段 (访存取数)**：
        1.  从指令中取出形式地址（例如，这里的常数6），送入内存地址寄存器MAR.
        2.  通过地址总线访问内存地址6.
        3.  从内存地址6读出数据，通过数据总线送入缓冲寄存器DR.
    *   **执行阶段 (数据传送)**：
        1.  将缓冲寄存器DR中的数据送入寄存器R1.

### 5.2.4.3 无需访存取操作数的指令：RR型ADD指令
*   **功能**：将寄存器R1和R2的内容相加，结果存入寄存器R2。例如：`ADD R1, R2` 表示 `R1 + R2 → R2`。
*   **执行周期**：与NOT指令类似，无需独立的取操作数阶段.
    *   **取指周期**：完成将指令从内存取到IR的过程.
    *   **执行周期**：
        1.  将寄存器R1的内容送至ALU的一个输入端.
        2.  将寄存器R2的内容送至ALU的另一个输入端.
        3.  ALU执行ADD操作.
        4.  将ALU的运算结果送至寄存器R2.

### 5.2.4.4 寄存器间址存操作数的指令：RS型STO指令
*   **功能**：将寄存器R2的内容送入由寄存器R3指定的内存单元。例如：`STO R2, (R3)` 表示 `R2 → M[(R3)]`。这是寄存器间接寻址方式。
*   **执行周期**：包含取指和执行阶段。执行阶段需要访存（写回内存），但不需要独立的“取操作数”阶段来读取操作数本身。
    *   **取指周期**：完成将指令从内存取到IR的过程.
    *   **执行阶段 (访存写数)**：
        1.  将寄存器R3的内容（作为有效地址）送入内存地址寄存器MAR.
        2.  将寄存器R2的内容（作为待存数据）送入缓冲寄存器DR.
        3.  根据控制信号（如`WE`，写信号），通过地址总线和数据总线将DR中的数据写入MAR指定的内存单元.

### 5.2.4.5 转移指令：JMP指令
*   **功能**：将指令中给出的目标地址送入程序计数器PC，使CPU转到该地址执行下一条指令。例如：`JMP Dest` 表示 `Dest → PC`.
*   **执行周期**：主要操作是在执行阶段修改PC的值.
    *   **取指周期**：完成将指令从内存取到IR的过程.
    *   **执行阶段**：
        1.  从指令中获取目标地址 `Dest`.
        2.  将 `Dest` 送入程序计数器PC. （`Dest → PC`）
        完成此操作后，下一个取指周期将从新的PC值对应的地址开始取指令，实现程序转移.

## 5.2.5 数据通路实例
数据通路是CPU内各个寄存器以及系统总线之间的**信息传送通路**。指令的执行过程就是通过控制信号控制数据通路，在CPU各部件之间以及CPU与外部部件之间**依次、依条件传递信息**并进行必要的数据加工.

### 5.2.5.1 示例描述
*   **结构**：以一个**双总线结构**的机器为例进行说明. 双总线结构意味着CPU内部至少有两条主要总线用于数据传输.
*   **主要部件**：示例机器包含的关键部件及其作用：
    *   **IR (指令寄存器)**：保存当前正在执行的指令.
    *   **PC (程序计数器)**：存放下一条指令的地址，具有自增功能.
    *   **M (主存)**：存储指令和数据，受读写信号R/W控制.
    *   **AR (地址寄存器)**：保存当前CPU访问的内存或I/O地址.
    *   **DR (数据缓冲寄存器)**：CPU与内存/I/O之间的数据中转站，补偿速度差异.
    *   **R0~R3 (寄存器组)**：存放操作数和结果的通用寄存器.
    *   **ALU (算术逻辑单元)**：执行算术和逻辑运算，由加、减等控制信号决定具体操作.
    *   **控制信号G**：控制总线旁路器，可能用于控制数据流向或使能总线连接.

### 5.2.5.2 指令执行微操作序列示例
设计硬布线控制器时，需要列出每条指令执行过程中各个阶段所包含的**微操作序列**及其对应的**控制信号**。微操作是计算机中最基本、不可再分的操作，由微命令控制完成。
以示例机器中的取指和ADD指令为例：
*   **取指微操作序列**：
    *   `PC → AR`: 将PC内容送往地址寄存器AR. 控制信号：`PCo, G, ARi` (PC输出、总线使能、AR输入).
    *   `(M) → DR`: 根据AR中地址，从主存读出数据送往DR. 控制信号：`R/W=R` (读控制信号), 读取的数据通过数据总线送入DR (隐含的DB->DR传输).
    *   `DR → IR`: 将DR内容送往指令寄存器IR. 控制信号：`DRo, G, IRi` (DR输出、总线使能、IR输入).
    *   `PC＋1 → PC`: PC值加1，指向下一条指令（对于定长指令）. 控制信号：`PC+1`. (源文档此处示例写的是`PCo，G，ARi`之后紧跟着`R/W=R`和`DRo，G，IRi`，但标准的取指还应包含PC自增。在控制器设计实例中提到了`PC+1 = M1·T4`，说明PC自增是一个微操作).
*   **ADD R2, R0 指令微操作序列 (R0+R2→R0)**：
    *   **取指**：同上.
    *   **执行**：
        *   `R2 → Y`: 将R2内容送往ALU的Y输入端. 控制信号：`R2o, G, Yi`.
        *   `R0 → X`: 将R0内容送往ALU的X输入端. 控制信号：`R0o, G, Xi`.
        *   `X+Y → R0`: ALU执行加法，结果送往R0. 控制信号：`+, ALUo, G, R0i` (加法操作、ALU输出、总线使能、R0输入).
*   **指令周期流程图绘制说明**：
    绘制指令周期流程图是将指令执行分解为微操作并安排时序的过程.
    1.  分析指令功能和数据通路.
    2.  确定指令执行所需的微操作步骤.
    3.  将这些微操作按时间顺序和逻辑关系排列，形成流程.
    4.  流程图的每个节点可以代表一个或一组同时进行的微操作，箭头表示时序先后关系.
    5.  可以标注每个微操作所需的控制信号.
    对于不同的指令，流程图的执行阶段会有所不同. 复杂的指令可能有更多的微操作和更复杂的流程分支（例如条件转移指令）.
指令周期是理解CPU如何执行程序的核心，通过分析不同类型指令的执行过程和所需微操作，可以深入理解CPU的功能实现和控制方式.